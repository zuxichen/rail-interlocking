\documentclass[10pt,a4paper]{report}
\usepackage{bsymb,b2latex}
\begin{document}
\SingleHeader{SR\_M1}
\MACHINE{SR\_M1}{SR\_M0}{SR1\_Block}{}
\VARIABLES{
	\Variable{Route\_Req}{}
	\Variable{Route\_Cel}{}
	\Variable{Route\_Occ}{}
	\Variable{Route2Path}{}
	\Variable{Block2Route}{}
	\Variable{Route2OccPath}{}
}
\INVARIANTS{
	\Invariant{inv1}{false}{$Block2Route \in{} BLOCK \pfun{} ROUTE$}{\\reserve}
	\Invariant{inv2}{false}{$Route2OccPath \in{} ROUTE \pfun{} PATH$}{}
	\Invariant{inv3}{false}{$\forall{}p\qdot{}p \in{} PATH \limp{} (\forall{}q\qdot{}q \notin{} PathConflict[\{p\}] \leqv{} (Path2Block[\{p\}] \binter{} Path2Block[\{q\}] = \emptyset{}))$}{}
}
\EVENTS{
\INITIALISATION{true}{}{
	\ACTIONS{false}{
		\Action{act1}{$Route\_Req  \bcmeq{}  \emptyset{}$}{false}{}
		\Action{act2}{$Route\_Cel  \bcmeq{}  \emptyset{}$}{false}{}
		\Action{act3}{$Route\_Occ \bcmeq{} \emptyset{}$}{false}{}
		\Action{act4}{$Route2Path \bcmeq{} \emptyset{}$}{false}{}
		\Action{act5}{$Block2Route \bcmeq{} \emptyset{}$}{true}{}
		\Action{act6}{$Route2OccPath \bcmeq{} \emptyset{}$}{true}{}
	}
}
\EVT{ATS\_Request}{true}{ordinary}{ATS\_Request}{}{
	\ANY{
		\Param{r}{false}{}
	}
	\GUARDS{true}{
		\Guard{grd1}{false}{$r \notin{} Route\_Req$}{false}{}
	}
	\ACTIONS{true}{
		\Action{act1}{$Route\_Req \bcmeq{} Route\_Req \bunion{} \{r\}$}{false}{}
	}
}
\EVT{Block\_Reserve}{false}{ordinary}{}{}{
	\ANY{
		\Param{r}{true}{}
		\Param{p}{true}{}
	}
	\GUARDS{true}{
		\Guard{grd1}{false}{$r \in{} Route\_Req$}{true}{}
		\Guard{grd2}{false}{$r \notin{} Route\_Cel$}{true}{}
		\Guard{grd3}{false}{$r \notin{} dom(Route2Path)$}{true}{}
		\Guard{grd4}{false}{$p \in{} PATH$}{true}{}
		\Guard{grd5}{false}{$p = Route2InitPath(r)$}{true}{}
		\Guard{grd6}{false}{$Path2Block[\{p\}] \binter{} dom(Block2Route) = \emptyset{}$}{true}{}
	}
	\ACTIONS{true}{
		\Action{act1}{$Block2Route \bcmeq{} Block2Route \bunion{} (Path2Block[\{p\}] \cprod{} \{r\})$}{true}{}
	}
}
\EVT{Route\_Reserve}{true}{ordinary}{Route\_Reserve}{}{
	\ANY{
		\Param{r}{false}{}
	}
	\GUARDS{true}{
		\Guard{grd1}{false}{$r \in{} Route\_Req$}{false}{}
		\Guard{grd2}{false}{$r \notin{} Route\_Cel$}{false}{}
		\Guard{grd3}{false}{$r \notin{} dom(Route2Path)$}{false}{}
		\Guard{grd4}{false}{$PathConflict[Route2InitPath[\{r\}]] \binter{} ran(Route2Path)=\emptyset{}$}{false}{}
		\Guard{grd5}{false}{$Block2Route\converse{}[\{r\}] = Path2Block[\{Route2InitPath(r)\}]$}{true}{}
	}
	\ACTIONS{true}{
		\Action{act1}{$Route2Path \bcmeq{} Route2Path \bunion{} \{r\mapsto{}Route2InitPath(r)\} $}{false}{}
	}
}
\EVT{Train\_Enter}{true}{ordinary}{Train\_Enter}{}{
	\ANY{
		\Param{r}{false}{}
	}
	\GUARDS{true}{
		\Guard{grd1}{false}{$r \in{} dom(Route2Path)$}{false}{}
		\Guard{grd2}{false}{$r \notin{} Route\_Occ$}{false}{}
		\Guard{grd3}{false}{$r \notin{} dom(Route2OccPath)$}{true}{}
	}
	\ACTIONS{true}{
		\Action{act1}{$Route\_Occ \bcmeq{} Route\_Occ \bunion{} \{r\}$}{false}{}
		\Action{act2}{$Route2OccPath \bcmeq{} Route2OccPath \bunion{} \{r \mapsto{} NullPath\}$}{true}{}
	}
}
\EVT{Train\_Head\_Move}{false}{ordinary}{}{}{
	\ANY{
		\Param{r}{true}{}
		\Param{op}{true}{}
		\Param{b}{true}{}
	}
	\GUARDS{true}{
		\Guard{grd1}{false}{$r \in{} Route\_Occ$}{true}{}
		\Guard{grd2}{false}{$r \in{} dom(Route2Path)$}{true}{}
		\Guard{grd4}{false}{$b \in{} Path2Block[\{Route2Path(r)\}]$}{true}{}
		\Guard{grd5}{false}{$r \in{} dom(Route2OccPath)$}{true}{}
		\Guard{grd6}{false}{$op = Route2OccPath(r)$}{true}{}
		\Guard{grd7}{false}{$b \notin{} Path2Block[\{op\}]$}{true}{}
	}
	\ACTIONS{true}{
		\Action{act1}{$Route2OccPath(r) \bcmeq{} PathIncrease(op)(b)$}{true}{}
	}
}
\EVT{Train\_Rear\_Move}{false}{ordinary}{}{}{
	\ANY{
		\Param{r}{true}{}
		\Param{op}{true}{}
		\Param{b}{true}{}
		\Param{p}{true}{}
	}
	\GUARDS{true}{
		\Guard{grd1}{false}{$r \in{} Route\_Occ$}{true}{}
		\Guard{grd2}{false}{$r \in{} dom(Route2OccPath)$}{true}{}
		\Guard{grd3}{false}{$op = Route2OccPath(r)$}{true}{}
		\Guard{grd6}{false}{$p = Route2Path(r)$}{true}{}
		\Guard{grd4}{false}{$b \in{} Path2Block[\{op\}] \binter{} Path2Block[\{p\}]$}{true}{}
		\Guard{grd5}{false}{$op \neq{} NullPath$}{true}{}
		\Guard{grd7}{false}{$p \neq{} NullPath$}{true}{}
	}
	\ACTIONS{true}{
		\Action{act1}{$Route2OccPath(r) \bcmeq{} PathReduce(op)(b)$}{true}{}
		\Action{act2}{$Route2Path(r) \bcmeq{} PathReduce(p)(b)$}{true}{}
	}
}
\EVT{Block\_Release}{false}{ordinary}{}{}{
	\ANY{
		\Param{b}{true}{}
		\Param{r}{true}{}
	}
	\GUARDS{true}{
		\Guard{grd1}{false}{$r \in{} Route\_Occ$}{true}{}
		\Guard{grd2}{false}{$b \in{} Block2Route\converse{}[\{r\}]$}{true}{}
		\Guard{grd3}{false}{$b \notin{} Path2Block[\{Route2OccPath(r)\}]$}{true}{}
		\Guard{grd4}{true}{$b \notin{} Path2Block[\{Route2Path(r)\}]$}{true}{}
	}
	\ACTIONS{true}{
		\Action{act1}{$Block2Route \bcmeq{} \{b\} \domsub{} Block2Route$}{true}{}
	}
}
\EVT{Train\_Leave}{true}{ordinary}{Train\_Leave}{}{
	\ANY{
		\Param{r}{false}{}
	}
	\GUARDS{true}{
		\Guard{grd1}{false}{$r \in{} Route\_Occ$}{false}{}
		\Guard{grd2}{false}{$r \in{} dom(Route2Path)$}{false}{}
		\Guard{grd3}{false}{$Route2Path(r) = NullPath$}{false}{}
		\Guard{grd4}{false}{$Block2Route\converse{}[\{r\}] = \emptyset{}$}{true}{}
	}
	\ACTIONS{true}{
		\Action{act1}{$Route\_Occ \bcmeq{} Route\_Occ \setminus{} \{r\}$}{false}{}
		\Action{act2}{$Route2OccPath \bcmeq{} \{r\} \domsub{} Route2OccPath$}{true}{}
	}
}
\EVT{Route\_Release}{true}{ordinary}{Route\_Release}{}{
	\ANY{
		\Param{r}{false}{}
	}
	\GUARDS{true}{
		\Guard{grd1}{false}{$r \in{} dom(Route2Path)$}{false}{}
		\Guard{grd2}{false}{$Route2Path(r) = NullPath$}{false}{}
		\Guard{grd3}{false}{$r \notin{} Route\_Occ$}{false}{}
		\Guard{grd4}{false}{$Block2Route\converse{}[\{r\}] = \emptyset{}$}{true}{}
		\Guard{grd5}{false}{$r \notin{} dom(Route2OccPath)$}{true}{}
	}
	\ACTIONS{true}{
		\Action{act1}{$Route2Path \bcmeq{} \{r\} \domsub{} Route2Path $}{false}{}
		\Action{act2}{$Route\_Req \bcmeq{} Route\_Req \setminus{} \{r\}$}{false}{}
	}
}
\EVT{ATS\_Cancel}{true}{ordinary}{ATS\_Cancel}{}{
	\ANY{
		\Param{r}{false}{}
	}
	\GUARDS{true}{
		\Guard{grd1}{false}{$r \in{} Route\_Req$}{false}{}
	}
	\ACTIONS{true}{
		\Action{act1}{$Route\_Cel \bcmeq{} Route\_Cel \bunion{} \{r\}$}{false}{}
	}
}
\EVT{Block\_Cancel}{false}{ordinary}{}{}{
	\ANY{
		\Param{r}{true}{}
	}
	\GUARDS{true}{
		\Guard{grd1}{false}{$r \in{} Route\_Cel$}{true}{}
		\Guard{grd2}{false}{$r \in{} ran(Block2Route)$}{true}{}
		\Guard{grd3}{false}{$Path2Block[\{Route2Path(r)\}] \binter{} dom(Block2Route) = \emptyset{}$}{true}{}
	}
	\ACTIONS{true}{
		\Action{act1}{$Block2Route \bcmeq{} Block2Route \ransub{} \{r\}$}{true}{}
	}
}
\EVT{Route\_Cancel}{true}{ordinary}{Route\_Cancel}{}{
	\ANY{
		\Param{r}{false}{}
	}
	\GUARDS{true}{
		\Guard{grd1}{false}{$r \in{} Route\_Req$}{false}{}
		\Guard{grd2}{false}{$r \in{} Route\_Cel $}{false}{}
		\Guard{grd3}{false}{$r \notin{} Route\_Occ$}{false}{}
		\Guard{grd4}{false}{$r \in{} dom(Route2Path)$}{false}{}
		\Guard{grd5}{false}{$Block2Route\converse{}[\{r\}] = \emptyset{}$}{true}{}
	}
	\ACTIONS{true}{
		\Action{act1}{$Route\_Req \bcmeq{} Route\_Req \setminus{} \{r\}$}{false}{}
		\Action{act2}{$Route\_Cel \bcmeq{} Route\_Cel \setminus{} \{r\}$}{false}{}
		\Action{act3}{$Route2Path \bcmeq{} \{r\} \domsub{} Route2Path $}{false}{}
	}
}
}
\END
\end{document}
